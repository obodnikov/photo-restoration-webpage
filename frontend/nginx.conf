server {
    listen 80;
    server_name _;

    root /usr/share/nginx/html;
    index index.html;

    # Gzip for basic performance
    gzip on;
    gzip_types text/plain text/css application/json application/javascript application/xml;
    gzip_min_length 1024;

    # Explicitly set MIME types for CSS and JS (helps with X-Content-Type-Options: nosniff)
    types {
        text/html html htm;
        text/css css;
        application/javascript js mjs;
        application/json json;
        image/svg+xml svg;
        image/png png;
        image/jpeg jpg jpeg;
        image/gif gif;
        image/x-icon ico;
        font/woff woff;
        font/woff2 woff2;
        font/ttf ttf;
        font/eot eot;
    }

    # Static assets - Use ^~ to prevent regex location matching
    # ^~ modifier = if this matches, stop searching and use this block
    location ^~ /assets/ {
        # Files in /assets/ directory (Vite output)
        try_files $uri =404;
        access_log off;
        add_header Cache-Control "public, max-age=31536000, immutable";
        add_header X-Content-Type-Options "nosniff";
    }

    # Static root files (favicon, robots.txt, etc)
    location ~* ^/(favicon\.ico|robots\.txt|vite\.svg)$ {
        try_files $uri =404;
        access_log off;
        add_header Cache-Control "public, max-age=86400";
    }

    # Fonts from Google Fonts or local
    location ~* \.(woff|woff2|ttf|eot)$ {
        try_files $uri =404;
        access_log off;
        add_header Cache-Control "public, max-age=31536000, immutable";
        add_header Access-Control-Allow-Origin "*";
    }

    # Main SPA entry; React Router support
    # This catches everything else and falls back to index.html
    location / {
        try_files $uri $uri/ /index.html;
        add_header Cache-Control "no-cache, no-store, must-revalidate";
    }
}
